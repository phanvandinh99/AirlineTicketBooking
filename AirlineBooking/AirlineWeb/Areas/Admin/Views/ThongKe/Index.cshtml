
@{
    ViewBag.Title = "Thống kê vé và doanh thu";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    var labels = (List<string>)ViewBag.Labels;
    var soVe = (List<int>)ViewBag.SoVe;
    var doanhThu = (List<decimal>)ViewBag.DoanhThu;
    string type = ViewBag.Type as string ?? "ngay";
}
<article class="content items-list-page">
    <div class="title-search-block">
        <div class="title-block">
            <div class="row">
                <div class="col-md-6">
                    <h3>Thống kê vé bán & doanh thu</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="card items">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <form method="get" class="d-flex align-items-center" style="gap:10px;">
                <label class="mb-0">Thống kê theo:</label>
                <select name="type" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="ngay" @(type=="ngay"?"selected":"")>Ngày</option>
                    <option value="tuan" @(type=="tuan"?"selected":"")>Tuần</option>
                    <option value="thang" @(type=="thang"?"selected":"")>Tháng</option>
                    <option value="quy" @(type=="quy"?"selected":"")>Quý</option>
                    <option value="nam" @(type=="nam"?"selected":"")>Năm</option>
                </select>
            </form>
        </div>
        <div class="card-body">
            <div class="mb-4">
                <canvas id="veChart" height="80"></canvas>
            </div>
            <div>
                <canvas id="doanhThuChart" height="80"></canvas>
            </div>
        </div>
    </div>
</article>
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(labels));
const soVe = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(soVe));
const doanhThu = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(doanhThu));
// Biểu đồ số vé bán
new Chart(document.getElementById('veChart').getContext('2d'), {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'Số vé bán',
            data: soVe,
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});
// Biểu đồ doanh thu
new Chart(document.getElementById('doanhThuChart').getContext('2d'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Doanh thu (VND)',
            data: doanhThu,
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 2,
            fill: true,
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true, ticks: { callback: function(value){ return value.toLocaleString() + ' ₫'; } } } }
    }
});
</script>

